<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Text Comparison Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .description {
            color: #7f8c8d;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .bible-selector, .text-input {
            flex: 1;
            min-width: 300px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        textarea {
            height: 200px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        button:hover:not(:disabled) {
            background-color: #2980b9;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }
        
        .spinner {
            border: 4px solid #f3f3f7;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-section {
            margin-top: 30px;
            display: none;
        }
        
        .percentage-display {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f5f7fa;
        }
        
        .word-count {
            font-weight: bold;
            color: #3498db;
        }
        
        .error-message {
            background-color: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #c33;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .input-section {
                flex-direction: column;
            }
            
            .bible-selector, .text-input {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bible Text Comparison Tool</h1>
            <p class="description">Compare your text with different Bible versions to see the percentage of unique words that match.</p>
        </header>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading Bible text data...</p>
        </div>
        
        <div id="error-message" class="error-message" style="display: none;"></div>
        
        <section class="input-section">
            <div class="bible-selector">
                <h2>Select Bible Version</h2>
                <select id="bible-version">
                    <option value="">Loading versions...</option>
                </select>
                <div id="bible-info">
                    <p>Select a Bible version to see description</p>
                </div>
            </div>
            
            <div class="text-input">
                <h2>Enter Your Text</h2>
                <textarea id="user-text" placeholder="Paste your text here...">In the start, the divine being made the sky and the world. The planet was shapeless and vacant, with obscurity covering the profound.</textarea>
                <button id="compare-btn" disabled>Compare Texts</button>
            </div>
        </section>
        
        <section class="results-section" id="results-section">
            <div class="results-header">
                <h2>Comparison Results</h2>
            </div>
            
            <div class="percentage-display" id="percentage-result"></div>
            
            <table id="results-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <div style="margin-top: 30px;">
                <h3>Common Words</h3>
                <p id="common-words"></p>
            </div>
        </section>
        
        <footer>
            <p>Bible Text Comparison Tool &copy; 2025</p>
        </footer>
    </div>

    <script>
        // Simple Bible data manager without complex error handling
        class BibleDataManager {
            constructor() {
                this.bibleData = null;
                this.loadedVersion = null;
            }

            async loadBibleManifest() {
                try {
                    const response = await fetch('./data/manifest.json');
                    if (!response.ok) throw new Error('Manifest not found');
                    return await response.json();
                } catch (error) {
                    console.warn('Using fallback manifest');
                    return {
                        versions: [
                            { id: 'kjv', name: 'King James Version (KJV)', file: './data/kjv.json' },
                            { id: 'niv', name: 'New International Version (NIV)', file: './data/niv.json' },
                            { id: 'esv', name: 'English Standard Version (ESV)', file: './data/esv.json' },
                            { id: 'nasb', name: 'New American Standard Bible (NASB)', file: './data/nasb.json' },
                            { id: 'nlt', name: 'New Living Translation (NLT)', file: './data/nlt.json' }
                        ],
                        descriptions: {
                            kjv: "A classic English translation completed in 1611.",
                            niv: "A modern English translation.",
                            esv: "An essentially literal translation.",
                            nasb: "Known for literal translation approach.",
                            nlt: "A thought-for-thought translation."
                        }
                    };
                }
            }

            async loadBibleVersion(versionId) {
                if (this.loadedVersion === versionId && this.bibleData) {
                    return this.bibleData;
                }

                try {
                    const manifest = await this.loadBibleManifest();
                    const versionInfo = manifest.versions.find(v => v.id === versionId);
                    
                    if (!versionInfo) throw new Error('Version not found');
                    
                    // Fix the path if it starts with /
                    let filePath = versionInfo.file;
                    if (filePath.startsWith('/')) {
                        filePath = '.' + filePath;
                    }
                    
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error('Bible file not found');
                    
                    const bibleFileData = await response.json();
                    
                    // Extract text from various possible structures
                    let bibleText = '';
                    if (bibleFileData.text) {
                        bibleText = bibleFileData.text;
                    } else if (bibleFileData.fullText) {
                        bibleText = bibleFileData.fullText;
                    } else if (typeof bibleFileData === 'string') {
                        bibleText = bibleFileData;
                    } else {
                        // Fallback to sample text
                        throw new Error('Could not extract text');
                    }
                    
                    this.bibleData = bibleText;
                    this.loadedVersion = versionId;
                    return this.bibleData;
                    
                } catch (error) {
                    console.warn('Using sample text for:', versionId);
                    // Sample texts as fallback
                    const sampleTexts = {
                        kjv: "In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face of the deep. And the Spirit of God moved upon the face of the waters. And God said, Let there be light: and there was light. And God saw the light, that it was good: and God divided the light from the darkness.",
                        niv: "In the beginning God created the heavens and the earth. Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters. And God said, 'Let there be light,' and there was light. God saw that the light was good, and he separated the light from the darkness.",
                        esv: "In the beginning, God created the heavens and the earth. The earth was without form and void, and darkness was over the face of the deep. And the Spirit of God was hovering over the face of the waters. And God said, 'Let there be light,' and there was light. And God saw that the light was good. And God separated the light from the darkness.",
                        nasb: "In the beginning God created the heavens and the earth. And the earth was a formless and desolate emptiness, and darkness was over the surface of the deep, and the Spirit of God was hovering over the surface of the waters. Then God said, 'Let there be light'; and there was light. God saw that the light was good; and God separated the light from the darkness.",
                        nlt: "In the beginning God created the heavens and the earth. The earth was formless and empty, and darkness covered the deep waters. And the Spirit of God was hovering over the surface of the waters. Then God said, 'Let there be light,' and there was light. And God saw that the light was good. Then he separated the light from the darkness."
                    };
                    
                    this.bibleData = sampleTexts[versionId] || sampleTexts.kjv;
                    this.loadedVersion = versionId;
                    return this.bibleData;
                }
            }
        }

        // DOM elements
        const bibleVersionSelect = document.getElementById('bible-version');
        const bibleInfoDiv = document.getElementById('bible-info');
        const userTextArea = document.getElementById('user-text');
        const compareButton = document.getElementById('compare-btn');
        const resultsSection = document.getElementById('results-section');
        const percentageResult = document.getElementById('percentage-result');
        const resultsTable = document.getElementById('results-table');
        const commonWordsElement = document.getElementById('common-words');
        const loadingElement = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');

        const bibleManager = new BibleDataManager();

        // Show/hide loading
        function showLoading(show) {
            loadingElement.style.display = show ? 'block' : 'none';
        }

        // Show error message
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // Hide error message
        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Initialize the application
        async function initApp() {
            try {
                showLoading(true);
                hideError();
                
                const manifest = await bibleManager.loadBibleManifest();
                
                // Populate dropdown
                bibleVersionSelect.innerHTML = manifest.versions.map(version => 
                    `<option value="${version.id}">${version.name}</option>`
                ).join('');
                
                // Set up event listeners
                bibleVersionSelect.addEventListener('change', handleVersionChange);
                compareButton.addEventListener('click', handleCompare);
                
                compareButton.disabled = false;
                showLoading(false);
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showError('Error loading Bible versions. Using fallback data.');
                showLoading(false);
                
                // Fallback dropdown
                bibleVersionSelect.innerHTML = `
                    <option value="kjv">King James Version (KJV)</option>
                    <option value="niv">New International Version (NIV)</option>
                    <option value="esv">English Standard Version (ESV)</option>
                    <option value="nasb">New American Standard Bible (NASB)</option>
                    <option value="nlt">New Living Translation (NLT)</option>
                `;
                
                bibleVersionSelect.addEventListener('change', handleVersionChange);
                compareButton.addEventListener('click', handleCompare);
                compareButton.disabled = false;
            }
        }

        async function handleVersionChange() {
            const selectedVersion = bibleVersionSelect.value;
            if (!selectedVersion) return;

            try {
                const manifest = await bibleManager.loadBibleManifest();
                const description = manifest.descriptions[selectedVersion] || 'Description not available.';
                bibleInfoDiv.innerHTML = `<p><strong>${bibleVersionSelect.options[bibleVersionSelect.selectedIndex].text}</strong>: ${description}</p>`;
            } catch (error) {
                bibleInfoDiv.innerHTML = `<p>Select a version to compare texts.</p>`;
            }
        }

        async function handleCompare() {
            const selectedVersion = bibleVersionSelect.value;
            const userText = userTextArea.value.trim();
            
            if (!selectedVersion) {
                showError('Please select a Bible version.');
                return;
            }
            
            if (!userText) {
                showError('Please enter some text to compare.');
                return;
            }
            
            try {
                hideError();
                showLoading(true);
                
                const bibleText = await bibleManager.loadBibleVersion(selectedVersion);
                const result = calculateWordOverlap(bibleText, userText);
                displayResults(result);
                
                showLoading(false);
                
            } catch (error) {
                showError('Error comparing texts. Please try again.');
                console.error('Comparison error:', error);
                showLoading(false);
            }
        }

        function calculateWordOverlap(text1, text2) {
            // Clean and split into words
            const cleanText = (text) => text.toLowerCase().replace(/[^\w\s]/g, ' ').replace(/\s+/g, ' ').trim();
            
            const words1 = cleanText(text1).split(' ').filter(word => word.length > 0);
            const words2 = cleanText(text2).split(' ').filter(word => word.length > 0);
            
            const uniqueWords1 = new Set(words1);
            const uniqueWords2 = new Set(words2);
            
            const commonWords = new Set();
            for (const word of uniqueWords1) {
                if (uniqueWords2.has(word)) {
                    commonWords.add(word);
                }
            }
            
            const percentage = uniqueWords1.size > 0 ? 
                (commonWords.size / uniqueWords1.size) * 100 : 0;
            
            return {
                uniqueWords1: uniqueWords1.size,
                uniqueWords2: uniqueWords2.size,
                commonWords: commonWords.size,
                percentage: percentage,
                commonWordsList: Array.from(commonWords).sort()
            };
        }

        function displayResults(result) {
            resultsSection.style.display = 'block';
            percentageResult.textContent = `${result.percentage.toFixed(2)}% Match`;
            
            const tbody = resultsTable.querySelector('tbody');
            tbody.innerHTML = `
                <tr>
                    <td>Unique words in selected Bible version</td>
                    <td class="word-count">${result.uniqueWords1}</td>
                </tr>
                <tr>
                    <td>Unique words in your text</td>
                    <td class="word-count">${result.uniqueWords2}</td>
                </tr>
                <tr>
                    <td>Common words</td>
                    <td class="word-count">${result.commonWords}</td>
                </tr>
            `;
            
            commonWordsElement.textContent = result.commonWordsList.length > 0 ? 
                result.commonWordsList.join(', ') : 'No common words found.';
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initApp().catch(error => {
                console.error('Failed to initialize app:', error);
                showError('Failed to initialize application. Please refresh the page.');
            });
        });
    </script>
</body>
</html>