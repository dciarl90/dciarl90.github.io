<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Text Comparison Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .description {
            color: #7f8c8d;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .bible-selector, .text-input {
            flex: 1;
            min-width: 300px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        textarea {
            height: 200px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #666;
        }
        
        .results-section {
            margin-top: 30px;
            display: none;
        }
        
        .percentage-display {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .word-count {
            font-weight: bold;
            color: #3498db;
        }
        
        .file-status {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .input-section {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bible Text Comparison Tool</h1>
            <p class="description">Compare your text with different Bible versions to see the percentage of unique words that match.</p>
        </header>
        
        <div class="loading" id="loading">Loading Bible texts...</div>
        <div class="file-status" id="file-status">Checking Bible text files...</div>
        
        <section class="input-section">
            <div class="bible-selector">
                <h2>Select Bible Version</h2>
                <select id="bible-version">
                    <option value="">Loading Bible versions...</option>
                </select>
                <div id="bible-info">
                    <p>Select a Bible version to compare with your text</p>
                </div>
            </div>
            
            <div class="text-input">
                <h2>Enter Your Text</h2>
                <textarea id="user-text">In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face of the deep.</textarea>
                <button id="compare-btn" disabled>Compare Texts</button>
            </div>
        </section>
        
        <section class="results-section" id="results-section">
            <h2>Comparison Results</h2>
            
            <div class="percentage-display" id="percentage-result"></div>
            
            <table id="results-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Count</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            
            <div style="margin-top: 30px;">
                <h3>Common Words</h3>
                <p id="common-words"></p>
            </div>
        </section>
        
        <footer>
            <p>Bible Text Comparison Tool &copy; 2025</p>
        </footer>
    </div>

    <script>
        // Bible file paths - using your actual file structure
        const bibleFiles = {
            kjv: './data/kjv.json',
            niv: './data/niv.json', 
            esv: './data/esv.json',
            nasb: './data/nasb.json',
            nlt: './data/nlt.json'
        };

        // Cache for loaded Bible texts
        const bibleTextsCache = {};
        let filesLoaded = false;

        // Get DOM elements
        const bibleVersionSelect = document.getElementById('bible-version');
        const userTextArea = document.getElementById('user-text');
        const compareButton = document.getElementById('compare-btn');
        const resultsSection = document.getElementById('results-section');
        const percentageResult = document.getElementById('percentage-result');
        const resultsTable = document.getElementById('results-table');
        const commonWordsElement = document.getElementById('common-words');
        const loadingElement = document.getElementById('loading');
        const fileStatusElement = document.getElementById('file-status');

        // Load Bible text from JSON file
        async function loadBibleText(version) {
            // Return cached text if already loaded
            if (bibleTextsCache[version]) {
                return bibleTextsCache[version];
            }

            const filePath = bibleFiles[version];
            if (!filePath) {
                throw new Error(`No file path found for version: ${version}`);
            }

            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Extract text from JSON structure
                let bibleText = '';
                if (data.text) {
                    bibleText = data.text;
                } else if (data.fullText) {
                    bibleText = data.fullText;
                } else if (typeof data === 'string') {
                    bibleText = data;
                } else {
                    // Try to find text in the object
                    bibleText = JSON.stringify(data);
                }
                
                // Cache the result
                bibleTextsCache[version] = bibleText;
                return bibleText;
                
            } catch (error) {
                console.error(`Error loading ${version}:`, error);
                throw error;
            }
        }

        // Check if Bible files exist and load them
        async function initializeBibleTexts() {
            showLoading(true);
            fileStatusElement.textContent = 'Loading Bible text files...';
            
            const versions = Object.keys(bibleFiles);
            let loadedCount = 0;
            let errorCount = 0;

            // Try to load each Bible version
            for (const version of versions) {
                try {
                    await loadBibleText(version);
                    loadedCount++;
                    fileStatusElement.textContent = `Loaded ${loadedCount} of ${versions.length} Bible versions...`;
                } catch (error) {
                    errorCount++;
                    console.warn(`Could not load ${version}:`, error);
                }
            }

            showLoading(false);
            
            if (loadedCount > 0) {
                fileStatusElement.textContent = `✅ Successfully loaded ${loadedCount} Bible versions from JSON files`;
                if (errorCount > 0) {
                    fileStatusElement.textContent += ` (${errorCount} failed to load)`;
                }
                filesLoaded = true;
            } else {
                fileStatusElement.textContent = '❌ Could not load any Bible versions from JSON files. Using sample texts.';
                // Fallback to sample texts
                loadSampleTexts();
                filesLoaded = true;
            }

            // Enable the compare button
            compareButton.disabled = false;
            populateVersionDropdown();
        }

        // Fallback sample texts
        function loadSampleTexts() {
            const sampleTexts = {
                kjv: "In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face of the deep. And the Spirit of God moved upon the face of the waters. And God said, Let there be light: and there was light. And God saw the light, that it was good: and God divided the light from the darkness.",
                niv: "In the beginning God created the heavens and the earth. Now the earth was formless and empty, darkness was over the surface of the deep, and the Spirit of God was hovering over the waters. And God said, 'Let there be light,' and there was light. God saw that the light was good, and he separated the light from the darkness.",
                esv: "In the beginning, God created the heavens and the earth. The earth was without form and void, and darkness was over the face of the deep. And the Spirit of God was hovering over the face of the waters. And God said, 'Let there be light,' and there was light. And God saw that the light was good. And God separated the light from the darkness.",
                nasb: "In the beginning God created the heavens and the earth. And the earth was a formless and desolate emptiness, and darkness was over the surface of the deep, and the Spirit of God was hovering over the surface of the waters. Then God said, 'Let there be light'; and there was light. God saw that the light was good; and God separated the light from the darkness.",
                nlt: "In the beginning God created the heavens and the earth. The earth was formless and empty, and darkness covered the deep waters. And the Spirit of God was hovering over the surface of the waters. Then God said, 'Let there be light,' and there was light. And God saw that the light was good. Then he separated the light from the darkness."
            };
            
            Object.assign(bibleTextsCache, sampleTexts);
        }

        // Populate version dropdown
        function populateVersionDropdown() {
            const versions = [
                { id: 'kjv', name: 'King James Version (KJV)' },
                { id: 'niv', name: 'New International Version (NIV)' },
                { id: 'esv', name: 'English Standard Version (ESV)' },
                { id: 'nasb', name: 'New American Standard Bible (NASB)' },
                { id: 'nlt', name: 'New Living Translation (NLT)' }
            ];
            
            bibleVersionSelect.innerHTML = versions.map(version => 
                `<option value="${version.id}">${version.name}</option>`
            ).join('');
        }

        // Show/hide loading
        function showLoading(show) {
            loadingElement.style.display = show ? 'block' : 'none';
        }

        // Calculate word overlap
        function calculateWordOverlap(text1, text2) {
            const cleanText = (text) => {
                return text.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();
            };
            
            const words1 = cleanText(text1).split(' ').filter(word => word.length > 0);
            const words2 = cleanText(text2).split(' ').filter(word => word.length > 0);
            
            const uniqueWords1 = [...new Set(words1)];
            const uniqueWords2 = [...new Set(words2)];
            
            const commonWords = uniqueWords1.filter(word => uniqueWords2.includes(word));
            
            const percentage = uniqueWords1.length > 0 ? 
                (commonWords.length / uniqueWords1.length) * 100 : 0;
            
            return {
                uniqueWords1: uniqueWords1.length,
                uniqueWords2: uniqueWords2.length,
                commonWords: commonWords.length,
                percentage: percentage,
                commonWordsList: commonWords.sort()
            };
        }

        // Display results
        function displayResults(result, version) {
            resultsSection.style.display = 'block';
            percentageResult.textContent = `${result.percentage.toFixed(2)}% Match`;
            
            const tbody = resultsTable.querySelector('tbody');
            tbody.innerHTML = `
                <tr>
                    <td>Unique words in Bible version</td>
                    <td class="word-count">${result.uniqueWords1}</td>
                </tr>
                <tr>
                    <td>Unique words in your text</td>
                    <td class="word-count">${result.uniqueWords2}</td>
                </tr>
                <tr>
                    <td>Common words</td>
                    <td class="word-count">${result.commonWords}</td>
                </tr>
            `;
            
            commonWordsElement.textContent = result.commonWordsList.length > 0 ? 
                result.commonWordsList.join(', ') : 'No common words found.';
            
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Compare button handler
        compareButton.addEventListener('click', async function() {
            const selectedVersion = bibleVersionSelect.value;
            const userText = userTextArea.value.trim();
            
            if (!selectedVersion) {
                alert('Please select a Bible version.');
                return;
            }
            
            if (!userText) {
                alert('Please enter some text to compare.');
                return;
            }
            
            try {
                showLoading(true);
                fileStatusElement.textContent = `Loading ${selectedVersion} text...`;
                
                // Load the Bible text (will use cache if already loaded)
                const bibleText = await loadBibleText(selectedVersion);
                
                fileStatusElement.textContent = `✅ Comparing with ${selectedVersion} text (${bibleText.length} characters)`;
                showLoading(false);
                
                const result = calculateWordOverlap(bibleText, userText);
                displayResults(result, selectedVersion);
                
            } catch (error) {
                fileStatusElement.textContent = `❌ Error loading ${selectedVersion}: ${error.message}`;
                showLoading(false);
                alert('Error comparing texts. Please try again.');
            }
        });

        // Initialize when page loads
        window.addEventListener('load', function() {
            initializeBibleTexts().catch(error => {
                console.error('Initialization error:', error);
                fileStatusElement.textContent = '❌ Error initializing. Using sample texts.';
                loadSampleTexts();
                populateVersionDropdown();
                compareButton.disabled = false;
            });
        });
    </script>
</body>
</html>