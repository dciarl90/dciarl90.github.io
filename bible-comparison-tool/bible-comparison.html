<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Text Comparison Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .input-section {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .bible-selector, .text-input {
            flex: 1;
            min-width: 300px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        textarea {
            height: 200px;
            resize: vertical;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .debug-panel {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            display: none; /* Hidden by default */
        }
        
        .file-info {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        
        .debug-toggle {
            background-color: #95a5a6 !important;
            font-size: 14px !important;
            padding: 8px 15px !important;
        }
        
        .debug-toggle:hover {
            background-color: #7f8c8d !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bible Text Comparison Tool</h1>
            <p>Compare your text with Bible versions loaded from JSON files</p>
        </header>

        <div class="file-info" id="file-info">
            Loading Bible text files...
        </div>

        <section class="input-section">
            <div class="bible-selector">
                <h2>Select Bible Version</h2>
                <select id="bible-version">
                    <option value="">Select a version...</option>
                </select>
                <button onclick="loadSelectedVersion()">Load Selected Version</button>
                <button class="debug-toggle" onclick="toggleDebug()">Show Debug Info</button>
            </div>
            
            <div class="text-input">
                <h2>Enter Your Text</h2>
                <textarea id="user-text">In the beginning God created the heaven and the earth. And the earth was without form, and void; and darkness was upon the face of the deep.</textarea>
                <button id="compare-btn" onclick="compareTexts()">Compare Texts</button>
            </div>
        </section>

        <div class="debug-panel" id="debug-output">
            Debug information will appear here...
        </div>
        
        <section id="results-section" style="display: none;">
            <h2>Comparison Results</h2>
            <div id="percentage-result"></div>
            <div id="results-details"></div>
        </section>
    </div>

    <script>
        const debugOutput = document.getElementById('debug-output');
        const fileInfo = document.getElementById('file-info');
        const bibleVersionSelect = document.getElementById('bible-version');
        
        // Your actual file paths
        const bibleFiles = {
            kjv: './data/kjv.json',
            niv: './data/niv.json',
            esv: './data/esv.json',
            nasb: './data/nasb.json',
            nlt: './data/nlt.json'
        };

        let loadedBibleTexts = {};

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '❌ ' : type === 'success' ? '✅ ' : 'ℹ️ ';
            debugOutput.innerHTML += `[${timestamp}] ${prefix}${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }

        function toggleDebug() {
            const debugPanel = document.getElementById('debug-output');
            const toggleButton = document.querySelector('.debug-toggle');
            
            if (debugPanel.style.display === 'none') {
                debugPanel.style.display = 'block';
                toggleButton.textContent = 'Hide Debug Info';
            } else {
                debugPanel.style.display = 'none';
                toggleButton.textContent = 'Show Debug Info';
            }
        }

        // Test if a specific file exists and is valid JSON
        async function testFile(version) {
            const filePath = bibleFiles[version];
            log(`Testing ${version}: ${filePath}`);
            
            try {
                // First test if file exists
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                // Test if valid JSON
                const text = await response.text();
                const data = JSON.parse(text);
                
                log(`✅ ${version}: File exists and is valid JSON`, 'success');
                log(`   JSON structure: ${JSON.stringify(data).substring(0, 200)}...`);
                
                // Try to extract text
                let bibleText = extractTextFromData(data);
                if (bibleText) {
                    log(`✅ ${version}: Successfully extracted ${bibleText.length} characters of text`, 'success');
                    loadedBibleTexts[version] = bibleText;
                    return true;
                } else {
                    log(`❌ ${version}: Could not extract text from JSON structure`, 'error');
                    return false;
                }
                
            } catch (error) {
                log(`❌ ${version}: ${error.message}`, 'error');
                return false;
            }
        }

        // Extract text from various JSON structures
        function extractTextFromData(data) {
            if (typeof data === 'string') return data;
            if (data.text) return data.text;
            if (data.fullText) return data.fullText;
            if (data.content) return data.content;
            
            // If it's an object, try to find any large string
            if (typeof data === 'object') {
                for (let key in data) {
                    if (typeof data[key] === 'string' && data[key].length > 100) {
                        return data[key];
                    }
                }
                // If no large string found, stringify the whole object
                return JSON.stringify(data);
            }
            
            return null;
        }

        // Test all Bible files
        async function testAllFiles() {
            debugOutput.innerHTML = 'Testing all Bible JSON files...\n';
            loadedBibleTexts = {};
            
            const versions = ['kjv', 'niv', 'esv', 'nasb', 'nlt'];
            let successCount = 0;
            
            for (const version of versions) {
                const success = await testFile(version);
                if (success) successCount++;
            }
            
            fileInfo.innerHTML = `✅ ${successCount} of ${versions.length} Bible files loaded successfully`;
            
            // Update dropdown
            updateVersionDropdown();
        }

        // Load a specific version
        async function loadSelectedVersion() {
            const version = bibleVersionSelect.value;
            if (!version) {
                alert('Please select a Bible version');
                return;
            }
            
            log(`Loading ${version}...`);
            await testFile(version);
            updateVersionDropdown();
        }

        // Update the version dropdown
        function updateVersionDropdown() {
            bibleVersionSelect.innerHTML = '<option value="">Select a version...</option>';
            
            for (const [version, filePath] of Object.entries(bibleFiles)) {
                const isLoaded = loadedBibleTexts[version];
                const status = isLoaded ? '✅' : '❌';
                bibleVersionSelect.innerHTML += 
                    `<option value="${version}">${status} ${version.toUpperCase()} - ${isLoaded ? 'Loaded' : 'Click to load'}</option>`;
            }
        }

        // Compare texts
        function compareTexts() {
            const version = bibleVersionSelect.value;
            const userText = document.getElementById('user-text').value.trim();
            
            if (!version) {
                alert('Please select a Bible version');
                return;
            }
            
            if (!userText) {
                alert('Please enter some text to compare');
                return;
            }
            
            const bibleText = loadedBibleTexts[version];
            if (!bibleText) {
                alert(`Bible text for ${version} is not loaded. Please click "Load Selected Version" first.`);
                return;
            }
            
            const result = calculateWordOverlap(bibleText, userText);
            displayResults(result, version);
        }

        // Calculate word overlap
        function calculateWordOverlap(text1, text2) {
            const cleanText = (text) => text.toLowerCase().replace(/[^\w\s]/g, ' ').replace(/\s+/g, ' ').trim();
            
            const words1 = cleanText(text1).split(' ').filter(word => word.length > 0);
            const words2 = cleanText(text2).split(' ').filter(word => word.length > 0);
            
            const uniqueWords1 = [...new Set(words1)];
            const uniqueWords2 = [...new Set(words2)];
            
            const commonWords = uniqueWords1.filter(word => uniqueWords2.includes(word));
            
            const percentage = uniqueWords2.length > 0 ? (commonWords.length / uniqueWords2.length) * 100 : 0;
            
            return {
                uniqueWords1: uniqueWords1.length,
                uniqueWords2: uniqueWords2.length,
                commonWords: commonWords.length,
                percentage: percentage,
                commonWordsList: commonWords.sort()
            };
        }

        // Display results
        function displayResults(result, version) {
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('percentage-result').innerHTML = 
                `<h3 style="color: #2c3e50; text-align: center;">${result.percentage.toFixed(2)}% Match with ${version.toUpperCase()}</h3>`;
            
            document.getElementById('results-details').innerHTML = `
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;"><strong>Unique words in Bible version:</strong></td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; color: #3498db; font-weight: bold;">${result.uniqueWords1}</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;"><strong>Unique words in your text:</strong></td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; color: #3498db; font-weight: bold;">${result.uniqueWords2}</td>
                    </tr>
                    <tr>
                        <td style="padding: 10px;"><strong>Common words found:</strong></td>
                        <td style="padding: 10px; color: #3498db; font-weight: bold;">${result.commonWords}</td>
                    </tr>
                </table>
                <div style="margin-top: 20px;">
                    <strong>Common words:</strong> ${result.commonWordsList.join(', ')}
                </div>
            `;
            
            // Scroll to results
            document.getElementById('results-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize - auto-load all files
        window.addEventListener('load', async function() {
            fileInfo.innerHTML = 'Loading Bible files...';
            
            // Test all files automatically
            const versions = ['kjv', 'niv', 'esv', 'nasb', 'nlt'];
            let successCount = 0;
            
            for (const version of versions) {
                const success = await testFile(version);
                if (success) successCount++;
            }
            
            fileInfo.innerHTML = `✅ ${successCount} of ${versions.length} Bible versions loaded successfully`;
            updateVersionDropdown();
            
            // Auto-run comparison with KJV if it loaded
            if (loadedBibleTexts.kjv) {
                bibleVersionSelect.value = 'kjv';
                compareTexts();
            }
        });
    </script>
</body>
</html>